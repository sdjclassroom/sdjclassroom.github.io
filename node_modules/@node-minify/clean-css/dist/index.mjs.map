{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/*!\n * node-minify\n * Copyright(c) 2011-2024 Rodolphe Stoclin\n * MIT Licensed\n */\n\n/**\n * Module dependencies.\n */\nimport type { MinifierOptions } from \"@node-minify/types\";\nimport { utils } from \"@node-minify/utils\";\nimport CleanCSS from \"clean-css\";\n\n// type OptionsPossibleCleanCSS = string | boolean | Record<string, string> | { url: string };\n\n// type OptionsCleanCSS = {\n//   // _sourceMap: boolean | { url: string };\n//   // sourceMap: boolean | { url: string };\n//   [Key: string]: OptionsPossibleCleanCSS | Record<string, OptionsPossibleCleanCSS>;\n// };\n\n// type SettingsCleanCSS = {\n//   options: OptionsCleanCSS;\n// };\n\n// type MinifierOptionsCleanCSS = {\n//   settings: SettingsCleanCSS;\n// };\n\n/**\n * Run clean-css.\n * @param settings Clean-css options\n * @param content Content to minify\n * @param callback Callback\n * @param index Index of current file in array\n * @returns Minified content\n */\nconst minifyCleanCSS = ({\n    settings,\n    content,\n    callback,\n    index,\n}: MinifierOptions) => {\n    if (settings?.options?.sourceMap) {\n        settings.options._sourceMap = settings.options.sourceMap;\n        settings.options.sourceMap = true;\n    }\n    const _cleanCSS = new CleanCSS(\n        settings && { returnPromise: false, ...settings.options }\n    ).minify(content ?? \"\");\n    const contentMinified = _cleanCSS.styles;\n    if (\n        _cleanCSS.sourceMap &&\n        typeof settings?.options?._sourceMap === \"object\" &&\n        \"url\" in settings.options._sourceMap\n    ) {\n        utils.writeFile({\n            file:\n                typeof settings.options._sourceMap.url === \"string\"\n                    ? settings.options._sourceMap.url\n                    : \"\",\n            content: _cleanCSS.sourceMap.toString(),\n            index,\n        });\n    }\n    if (settings && !settings.content && settings.output) {\n        settings.output &&\n            utils.writeFile({\n                file: settings.output,\n                content: contentMinified,\n                index,\n            });\n    }\n    if (callback) {\n        return callback(null, contentMinified);\n    }\n    return contentMinified;\n};\n\n/**\n * Expose `minifyCleanCSS()`.\n */\nminifyCleanCSS.default = minifyCleanCSS;\nexport = minifyCleanCSS;\n"],"mappings":";;;;;;AAUA,SAAS,aAAa;AACtB,OAAO,cAAc;AAXrB;AAAA;AAqCA,QAAM,iBAAiB,CAAC;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ,MAAuB;AACnB,UAAI,UAAU,SAAS,WAAW;AAC9B,iBAAS,QAAQ,aAAa,SAAS,QAAQ;AAC/C,iBAAS,QAAQ,YAAY;AAAA,MACjC;AACA,YAAM,YAAY,IAAI;AAAA,QAClB,YAAY,EAAE,eAAe,OAAO,GAAG,SAAS,QAAQ;AAAA,MAC5D,EAAE,OAAO,WAAW,EAAE;AACtB,YAAM,kBAAkB,UAAU;AAClC,UACI,UAAU,aACV,OAAO,UAAU,SAAS,eAAe,YACzC,SAAS,SAAS,QAAQ,YAC5B;AACE,cAAM,UAAU;AAAA,UACZ,MACI,OAAO,SAAS,QAAQ,WAAW,QAAQ,WACrC,SAAS,QAAQ,WAAW,MAC5B;AAAA,UACV,SAAS,UAAU,UAAU,SAAS;AAAA,UACtC;AAAA,QACJ,CAAC;AAAA,MACL;AACA,UAAI,YAAY,CAAC,SAAS,WAAW,SAAS,QAAQ;AAClD,iBAAS,UACL,MAAM,UAAU;AAAA,UACZ,MAAM,SAAS;AAAA,UACf,SAAS;AAAA,UACT;AAAA,QACJ,CAAC;AAAA,MACT;AACA,UAAI,UAAU;AACV,eAAO,SAAS,MAAM,eAAe;AAAA,MACzC;AACA,aAAO;AAAA,IACX;AAKA,mBAAe,UAAU;AACzB,qBAAS;AAAA;AAAA;","names":[]}